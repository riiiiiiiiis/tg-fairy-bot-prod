# Требования к объединению таблиц квиза в одну

## Введение

Данная функция объединяет две отдельные таблицы Google Sheets (мужскую и женскую) в одну унифицированную таблицу. Цель - упростить управление контентом, иметь единый конфиг для сообщений и централизованное управление всем контентом квиза в одном месте.

## Требования

### Требование 1

**Пользовательская история:** Как администратор контента, я хочу управлять всем контентом квиза из одной таблицы Google Sheets, чтобы упростить процесс обновления и поддержки.

#### Критерии приемки

1. КОГДА система загружает данные, ТО она ДОЛЖНА использовать только одну таблицу Google Sheets
2. КОГДА нужно получить вопросы для определенного пола, ТО система ДОЛЖНА фильтровать данные по полю "gender" в таблице
3. КОГДА загружается конфигурация, ТО все сообщения ДОЛЖНЫ браться из единого листа Config
4. ЕСЛИ в таблице есть записи без указания пола, ТО они ДОЛЖНЫ применяться для обоих полов

### Требование 2

**Пользовательская история:** Как разработчик, я хочу иметь простую структуру данных с полем пола, чтобы легко фильтровать контент по гендерному признаку.

#### Критерии приемки

1. КОГДА система читает лист Questions, ТО каждый вопрос ДОЛЖЕН содержать поле "gender" со значениями "male", "female" или "both"
2. КОГДА система читает лист Answers, ТО каждый ответ ДОЛЖЕН содержать поле "gender" для связи с соответствующими вопросами
3. КОГДА система читает лист Archetypes, ТО каждый архетип ДОЛЖЕН содержать поле "gender" для определения целевой аудитории
4. ЕСЛИ поле "gender" содержит "both", ТО данная запись ДОЛЖНА использоваться для обоих полов

### Требование 3

**Пользовательская история:** Как пользователь, я хочу продолжать видеть персонализированный контент в зависимости от выбранного пола, чтобы получать релевантные вопросы и результаты.

#### Критерии приемки

1. КОГДА пользователь выбирает "Мужчина", ТО система ДОЛЖНА показывать только вопросы с gender="male" или gender="both"
2. КОГДА пользователь выбирает "Женщина", ТО система ДОЛЖНА показывать только вопросы с gender="female" или gender="both"
3. КОГДА отображаются результаты, ТО архетипы ДОЛЖНЫ соответствовать выбранному полу пользователя
4. КОГДА загружаются ответы для вопроса, ТО они ДОЛЖНЫ соответствовать полу пользователя или быть универсальными

### Требование 4

**Пользовательская история:** Как администратор системы, я хочу иметь единую конфигурацию окружения, чтобы упростить развертывание и поддержку.

#### Критерии приемки

1. КОГДА система инициализируется, ТО она ДОЛЖНА использовать только одну переменную SPREADSHEET_KEY
2. КОГДА происходит миграция, ТО старые переменные SPREADSHEET_KEY_MALE и SPREADSHEET_KEY_FEMALE ДОЛЖНЫ быть удалены
3. ЕСЛИ старые переменные все еще присутствуют, ТО система ДОЛЖНА логировать предупреждение о необходимости миграции
4. КОГДА система не может получить доступ к таблице, ТО она ДОЛЖНА показать понятное сообщение об ошибке

### Требование 5

**Пользовательская история:** Как администратор контента, я хочу иметь возможность легко добавлять контент для обоих полов или для конкретного пола, чтобы гибко управлять содержимым квиза.

#### Критерии приемки

1. КОГДА добавляется новый вопрос, ТО можно указать gender="both" для использования обоими полами
2. КОГДА создается архетип, ТО можно указать gender="male", "female" или "both"
3. КОГДА обновляются сообщения в Config, ТО изменения ДОЛЖНЫ применяться для всех пользователей независимо от пола
4. ЕСЛИ нужно создать пол-специфичный контент, ТО можно создать отдельные записи с соответствующим значением gender

### Требование 6

**Пользовательская история:** Как разработчик, я хочу иметь обратную совместимость с существующим кодом, чтобы минимизировать изменения в логике приложения.

#### Критерии приемки

1. КОГДА вызываются методы получения данных, ТО они ДОЛЖНЫ автоматически фильтровать по полу пользователя
2. КОГДА система получает вопросы, ТО интерфейс методов ДОЛЖЕН остаться прежним
3. КОГДА происходит кэширование, ТО данные ДОЛЖНЫ кэшироваться с учетом пола пользователя
4. ЕСЛИ код обращается к старым методам, ТО они ДОЛЖНЫ продолжать работать с новой структурой данных