# Структура Google Таблицы для Telegram Fairy Bot

## Обзор

Telegram Fairy Bot использует Google Таблицу как основной источник данных для викторины по архетипам личности. Таблица должна содержать 4 обязательных листа с определенной структурой столбцов.

## Требуемые листы

Таблица должна содержать следующие листы:
- **Config** - конфигурационные тексты бота
- **Questions** - вопросы викторины (19 штук)
- **Answers** - варианты ответов (по 6 на каждый вопрос)
- **Archetypes** - описания архетипов для результатов

## 1. Лист "Config"

### Назначение
Хранение всех текстовых сообщений бота, которые можно изменять без правки кода.

### Структура столбцов
| Столбец A | Столбец B |
|-----------|-----------|
| key       | value     |

### Обязательные ключи
```
key                    | value
-----------------------|----------------------------------------
welcome_sequence_1     | Добро пожаловать в тест архетипов!
welcome_sequence_2     | Узнайте свой тип личности за 5 минут
promo_sequence         | Готовы начать увлекательное путешествие?\\nОтветьте на 19 вопросов
promo_button_text      | Начать тест
instruction_sequence   | <b>Инструкция:</b>\\n\\nВыберите 3 варианта из 6 для каждого вопроса
start_button_text      | Начать викторину
final_cta_text         | Тест завершен!\\nПосмотрим ваши результаты?
final_cta_button       | Показать результаты
```

### Важные особенности
- Используйте `\\n` для переносов строк
- HTML-теги поддерживаются (`<b>`, `<i>`)
- Значения могут содержать эмодзи

## 2. Лист "Questions"

### Назначение
Хранение 19 вопросов викторины с дополнительными подсказками.

### Структура столбцов
| Столбец A    | Столбец B      | Столбец C    |
|--------------|----------------|--------------|
| question_id  | question_text  | prompt_text  |

### Требования к данным
- **question_id**: Числа от 1 до 19 (обязательно последовательно)
- **question_text**: Основной текст вопроса
- **prompt_text**: Подсказка или инструкция к вопросу

### Пример данных
```
question_id | question_text                           | prompt_text
1          | Как вы предпочитаете проводить выходные? | Выберите 3 наиболее подходящих варианта
2          | Что вас больше всего мотивирует?        | Отметьте то, что резонирует с вами
3          | Ваш идеальный рабочий день включает:    | Выберите 3 варианта из списка
```

## 3. Лист "Answers"

### Назначение
Хранение вариантов ответов для каждого вопроса с привязкой к архетипам.

### Структура столбцов
| Столбец A  | Столбец B    | Столбец C    | Столбец D     |
|------------|--------------|--------------|---------------|
| answer_id  | question_id  | answer_text  | archetype_id  |

### Требования к данным
- **answer_id**: Уникальный идентификатор ответа (любые числа)
- **question_id**: Ссылка на вопрос (1-19)
- **answer_text**: Текст варианта ответа
- **archetype_id**: Идентификатор архетипа (строка)

### Логика подсчета баллов
Пользователь выбирает 3 ответа из 6 для каждого вопроса:
- 1-й выбранный ответ: **3 балла** архетипу
- 2-й выбранный ответ: **2 балла** архетипу  
- 3-й выбранный ответ: **1 балл** архетипу

### Пример данных
```
answer_id | question_id | answer_text                    | archetype_id
1         | 1          | Читать книги дома              | introvert
2         | 1          | Встречаться с друзьями         | extrovert
3         | 1          | Заниматься творчеством         | creator
4         | 1          | Изучать что-то новое           | explorer
5         | 1          | Помогать другим                | caregiver
6         | 1          | Планировать будущее            | ruler
7         | 2          | Достижение целей               | ruler
8         | 2          | Помощь людям                   | caregiver
9         | 2          | Творческое самовыражение       | creator
```

**Важно:** Для каждого вопроса должно быть ровно 6 ответов!

## 4. Лист "Archetypes"

### Назначение
Хранение описаний архетипов, которые показываются в результатах.

### Структура столбцов
| Столбец A     | Столбец B         | Столбец C              |
|---------------|-------------------|------------------------|
| archetype_id  | main_description  | secondary_description  |

### Требования к данным
- **archetype_id**: Уникальный идентификатор (должен совпадать с Answers)
- **main_description**: Полное описание для 1-го места
- **secondary_description**: Краткое описание для 2-го и 3-го места

### Использование в боте
- **main_description** - показывается для архетипа с наибольшим количеством баллов
- **secondary_description** - показывается для 2-го и 3-го архетипов по баллам

### Пример данных
```
archetype_id | main_description                                    | secondary_description
introvert    | <b>Интроверт</b>\\n\\nВы черпаете энергию из...    | Также в вас есть черты интроверта...
extrovert    | <b>Экстраверт</b>\\n\\nВы получаете энергию от...  | Экстравертные качества проявляются...
creator      | <b>Творец</b>\\n\\nВы видите мир через призму...   | Творческое начало присутствует...
explorer     | <b>Исследователь</b>\\n\\nВас влечет неизвестное... | Дух исследователя живет в вас...
caregiver    | <b>Заботливый</b>\\n\\nВы находите смысл в...      | Забота о других - ваша сильная сторона...
ruler        | <b>Правитель</b>\\n\\nВы прирожденный лидер...     | Лидерские качества проявляются...
```

### Форматирование
- Используйте HTML-теги: `<b>`, `<i>`
- Переносы строк: `\\n`
- Можно использовать эмодзи

## Настройка доступа

### 1. Создание Service Account

1. Перейдите в [Google Cloud Console](https://console.cloud.google.com/)
2. Создайте новый проект или выберите существующий
3. Включите Google Sheets API:
   - Перейдите в "APIs & Services" → "Library"
   - Найдите "Google Sheets API" и включите его

4. Создайте Service Account:
   - Перейдите в "APIs & Services" → "Credentials"
   - Нажмите "Create Credentials" → "Service Account"
   - Заполните название и описание
   - Нажмите "Create and Continue"

5. Скачайте JSON-ключ:
   - В списке Service Accounts нажмите на созданный аккаунт
   - Перейдите на вкладку "Keys"
   - Нажмите "Add Key" → "Create new key" → "JSON"
   - Сохраните файл

### 2. Настройка прав доступа

1. Откройте вашу Google Таблицу
2. Нажмите кнопку "Поделиться" (Share)
3. Добавьте email Service Account (из JSON-файла, поле `client_email`)
4. Установите права доступа: **"Читатель"** (Viewer)
5. Нажмите "Отправить"

### 3. Конфигурация в боте

Добавьте в файл `.env`:
```env
SPREADSHEET_KEY=ваш_id_таблицы_из_url
GOOGLE_CREDENTIALS_JSON={"type":"service_account",...весь_json...}
```

**ID таблицы** находится в URL:
`https://docs.google.com/spreadsheets/d/SPREADSHEET_KEY/edit`

## Проверка настройки

Для проверки правильности настройки:

1. Убедитесь, что все 4 листа созданы с правильными названиями
2. Проверьте структуру столбцов в каждом листе
3. Заполните минимальные тестовые данные
4. Запустите бота и проверьте логи на ошибки подключения

## Частые ошибки

### "Worksheet not found"
- Проверьте точные названия листов: Config, Questions, Answers, Archetypes
- Названия чувствительны к регистру

### "Permission denied"
- Убедитесь, что Service Account добавлен в права доступа к таблице
- Проверьте правильность SPREADSHEET_KEY в .env

### "Cell not found" в Config
- Убедитесь, что все обязательные ключи присутствуют в листе Config
- Проверьте точность написания ключей

### Проблемы с кодировкой
- Используйте `\\n` вместо реальных переносов строк
- Проверьте корректность HTML-тегов